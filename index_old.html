<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Reports Tab</title>
  <style>
    /* [Same CSS as before — not repeated here for brevity] */
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    Proteus Automation Reports
    <button id="refreshPage" onclick="updateTotalReports()">Refresh</button>
  </div>
  <div class="body-content">
    <div class="sidebar">
      <button onclick="showTab('home', this)" class="active">Home</button>
      <button onclick="showTab('reports', this)">Reports</button>
    </div>
    <div class="main">
      <div id="home" class="tab-content active">
        <div class="card">
          <h2>Welcome to the Dashboard</h2>
          <p>Select "Reports" from the left menu to view HTML reports.</p>
          <div id="totalReports">
            <button>
              Total Reports Available: <span id="reportCount">0</span>
              <div id="passFailSummary"></div>
            </button>
          </div>
          <div class="summary-container">
            <div id="iosSummary" class="report-section">
              <h3>iOS Execution Summary</h3>
              <p>Total Reports: <span id="iosReportsCount">0</span></p>
              <p>Total Features Passed: <span id="iosFeaturesPassed">-</span></p>
              <p>Total Features Failed: <span id="iosFeaturesFailed">-</span></p>
              <p>Total Scenarios Passed: <span id="iosScenariosPassed">-</span></p>
              <p>Total Scenarios Failed: <span id="iosScenariosFailed">-</span></p>
              <p>Total Scenarios Skipped: <span id="iosScenariosSkipped">-</span></p>
            </div>
            <div id="androidSummary" class="report-section">
              <h3>Android Execution Summary</h3>
              <p>Total Reports: <span id="androidReportsCount">-</span></p>
              <p>Total Features Passed: <span id="androidFeaturesPassed">-</span></p>
              <p>Total Features Failed: <span id="androidFeaturesFailed">-</span></p>
              <p>Total Scenarios Passed: <span id="androidScenariosPassed">-</span></p>
              <p>Total Scenarios Failed: <span id="androidScenariosFailed">-</span></p>
              <p>Total Scenarios Skipped: <span id="androidScenariosSkipped">-</span></p>
            </div>
          </div>
        </div>
      </div>

      <div id="reports" class="tab-content">
        <div class="card" id="reportsCard">
          <div id="reports-container">
            <div class="report-section">
              <h3>iOS Reports</h3>
              <table class="report-table" id="ios-report-table">
                <thead>
                <tr>
                  <th>Report</th>
                  <th>Pass</th>
                  <th>Fail</th>
                  <th>Skipped</th>
                </tr>
                </thead>
                <tbody id="ios-reports-table-body"></tbody>
              </table>
            </div>
            <div class="report-section">
              <h3>Android Reports</h3>
              <table class="report-table" id="android-report-table">
                <thead>
                <tr>
                  <th>Report</th>
                  <th>Pass</th>
                  <th>Fail</th>
                  <th>Skipped</th>
                </tr>
                </thead>
                <tbody id="android-reports-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<button id="backToTop" onclick="scrollToTop()">↑</button>

<script>
  async function fetchAllReports() {
    try {
      const response = await fetch("AllReports.json");
      if (!response.ok) throw new Error("Failed to fetch AllReports.json");
      return await response.json();
    } catch (error) {
      console.error("Error loading AllReports.json:", error);
      return { ios: { reports: [] }, android: { reports: [] } };
    }
  }

  function populateReportTable(platform, reports) {
    const tableBody = document.getElementById(`${platform}-reports-table-body`);
    let rowsHtml = "";
    reports.forEach(report => {
      const linkHref = `./${platform.charAt(0).toUpperCase() + platform.slice(1)}/${report.reportFolder}/index.html`;
      rowsHtml += `
        <tr>
          <td><a href="${linkHref}">${report.reportFolder}</a></td>
          <td>${report.passChild ?? '-'}</td>
          <td>${report.failChild ?? '-'}</td>
          <td>${report.skipChild ?? '-'}</td>
        </tr>
      `;
    });
    tableBody.innerHTML = rowsHtml;
  }

  function updateSummary(platform, data) {
    document.getElementById(`${platform}ReportsCount`).textContent = data.reports.length;
    document.getElementById(`${platform}FeaturesPassed`).textContent = data.totalFeaturesPassed ?? '-';
    document.getElementById(`${platform}FeaturesFailed`).textContent = data.totalFeaturesFailed ?? '-';
    document.getElementById(`${platform}ScenariosPassed`).textContent = data.totalPassChild ?? '-';
    document.getElementById(`${platform}ScenariosFailed`).textContent = data.totalFailChild ?? '-';
    document.getElementById(`${platform}ScenariosSkipped`).textContent = data.totalSkipChild ?? '-';
  }

  async function updateTotalReports() {
    const allData = await fetchAllReports();
    populateReportTable("ios", allData.ios.reports);
    populateReportTable("android", allData.android.reports);

    const totalCount = allData.ios.reports.length + allData.android.reports.length;
    document.getElementById("reportCount").textContent = totalCount;

    updateSummary("ios", allData.ios);
    updateSummary("android", allData.android);
  }

  function showTab(tabId, button) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    button.classList.add('active');
    document.getElementById('backToTop').style.display = (tabId === 'reports') ? 'block' : 'none';
    updateTotalReports();
  }

  function scrollToTop() {
    document.getElementById('reportsCard').scrollTo({ top: 0, behavior: 'smooth' });
  }

  document.addEventListener('DOMContentLoaded', updateTotalReports);
</script>
</body>
</html>
