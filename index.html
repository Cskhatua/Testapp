<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard - Reports Tab</title>
  <style>
    /* Existing styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    /* Additional styles for dynamic report links */
    h3 {
      color: #007BFF;
    }
    .report-section ul {
      list-style-type: none;
      padding: 0;
    }
    .report-section ul li {
      margin-bottom: 8px;
    }
    .report-section ul li a {
      text-decoration: none;
      color: #007BFF;
    }
    .report-section ul li a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    Proteus Automation Reports
  </div>
  <div class="body-content">
    <div class="sidebar">
      <button id="homeBtn" onclick="showTab('home', this)" class="active">Home</button>
      <button id="reportsBtn" onclick="showTab('reports', this)">Reports</button>
    </div>
    <div class="main">
      <div id="home" class="tab-content active">
        <div class="card">
          <h2>Welcome to the Dashboard</h2>
          <p>Select "Reports" from the left menu to view HTML reports.</p>
          <div class="total-reports-box" id="totalReports">
            <h3>Total Reports</h3>
            <div class="count" id="reportCount">0</div>
          </div>
        </div>
      </div>

      <div id="reports" class="tab-content">
        <div class="card" id="reportsCard">
          <div class="report-sections">
            <div id="iosReports" class="report-section">
              <h3>iOS Reports</h3>
              <ul id="iosLinks">
                <!-- iOS links will be dynamically populated here -->
              </ul>
            </div>

            <div id="androidReports" class="report-section">
              <h3>Android Reports</h3>
              <ul id="androidLinks">
                <!-- Android links will be dynamically populated here -->
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    function showTab(tabId, element) {
      document.querySelectorAll('.tab-content').forEach(function(tab) {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.sidebar button').forEach(function(btn) {
        btn.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
      element.classList.add('active');
      document.getElementById('backToTop').style.display = (tabId === 'reports') ? 'block' : 'none';

      if (tabId === 'home') {
        updateTotalReports();
      }
    }

    function updateTotalReports() {
      const iosReports = document.querySelectorAll('#iosReports a').length;
      const androidReports = document.querySelectorAll('#androidReports a').length;
      const totalReports = iosReports + androidReports;
      document.getElementById('reportCount').textContent = totalReports;
    }

    // Fetch file list from a directory in the repository
    async function fetchFiles(folder, targetListId) {
      const repoOwner = "Cskhatua";
      const repoName = "Testapp";
      const branch = "gh-pages";
      const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}?ref=${branch}`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error(`Error fetching ${folder} files`);
        }
        const files = await response.json();
        const listElement = document.getElementById(targetListId);

        files.forEach(file => {
          if (file.type === "dir" || file.type === "file") {
            const listItem = document.createElement("li");
            const link = document.createElement("a");
            link.href = `https://github.com/${repoOwner}/${repoName}/tree/${branch}/${folder}/${file.name}`;
            link.textContent = file.name;
            listItem.appendChild(link);
            listElement.appendChild(listItem);
          }
        });
      } catch (error) {
        console.error(error);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchFiles("iOS", "iosLinks");
      fetchFiles("Android", "androidLinks");
      updateTotalReports();
    });
  </script>
</body>
</html>