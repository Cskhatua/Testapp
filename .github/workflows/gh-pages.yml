name: Generate and Deploy All_Reports.html

# Trigger this workflow when anything changes inside the combined-reports folder
on:
  push:
    paths:
      - 'combined-reports/**'

jobs:
  generate-report: # First job: create the HTML index
    runs-on: self-hosted # You can change to ubuntu-latest if you don't use a self-hosted runner

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3 # Checkout the code from the repo

      - name: Prepare Testapp directory and generate All_Reports.html
        run: |
          # Create output structure and copy reports into Testapp/
          mkdir -p Testapp/combined-reports
          cp -r combined-reports/* Testapp/combined-reports/

          # Navigate to the folder where HTML index will be generated
          cd Testapp/combined-reports

          # Start building the HTML index
          echo "<!DOCTYPE html>" > All_Reports.html
          echo "<html><head><title>All Reports</title></head><body>" >> All_Reports.html
          echo "<h1>All Reports</h1>" >> All_Reports.html

          # Add folder links (only folders inside combined-reports)
          echo "<h2>Folders</h2>" >> All_Reports.html
          for folder in */; do
            foldername=$(basename "$folder")
            echo "<a href='$folder'>$foldername/</a><br>" >> All_Reports.html
          done

          # Add HTML file links (excluding the index file itself)
          echo "<h2>HTML Files</h2>" >> All_Reports.html
          for file*